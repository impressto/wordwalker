# Flash Cards Dynamic Generation

## Overview

Flash cards are now dynamically generated by compositing multiple image layers on canvas:

1. **Background** - From `public/images/flash-cards/backgrounds/`
2. **Character** - From `public/images/flash-cards/characters/{character}/`
3. **Object** - From `public/images/flash-cards/objects/`
4. **Text Overlay** - Spanish and English text rendered on top

## File Structure

```
public/images/flash-cards/
â”œâ”€â”€ backgrounds/
â”‚   â””â”€â”€ purple.png              # Background images
â”œâ”€â”€ characters/
â”‚   â””â”€â”€ elvis/                  # Character folders
â”‚       â”œâ”€â”€ angry.png
â”‚       â”œâ”€â”€ confused.png
â”‚       â”œâ”€â”€ defensive.png
â”‚       â”œâ”€â”€ disappointed.png
â”‚       â”œâ”€â”€ horrified.png
â”‚       â”œâ”€â”€ indifferent.png
â”‚       â”œâ”€â”€ laughing.png
â”‚       â”œâ”€â”€ pleased.png
â”‚       â””â”€â”€ welcoming.png
â””â”€â”€ objects/
    â”œâ”€â”€ la sandÃ­a.png          # Object images (named with Spanish text)
    â”œâ”€â”€ el plÃ¡tano.png
    â”œâ”€â”€ la manzana.png
    â””â”€â”€ ... (one per vocabulary item)
```

## Configuration Format

### Category Config (`src/config/flash-cards/food.js`)

```javascript
export const foodFlashCardsConfig = {
  totalCards: 10,
  canvasWidth: 360,
  canvasHeight: 240,
  
  // Defaults (can be overridden per card)
  defaultBackground: 'purple.png',
  defaultCharacter: 'elvis',
  defaultEmotion: 'laughing.png',
  
  cards: [
    { 
      questionId: 'food_001',
      object: 'la sandÃ­a.png',
      emotion: 'pleased.png',
      // Optional overrides:
      // background: 'blue.png',
      // character: 'maria',
    },
    // ... more cards
  ],
  
  // Optional text styling
  text: { /* ... */ },
  
  // Optional diamond animation settings
  diamond: { /* ... */ },
};
```

## Card Configuration Properties

### Required Properties
- `questionId` - Links to question data for Spanish/English text
- `object` - Filename of object image in `objects/` folder

### Optional Properties
- `emotion` - Overrides `defaultEmotion` (e.g., 'laughing.png')
- `background` - Overrides `defaultBackground` (e.g., 'blue.png')
- `character` - Overrides `defaultCharacter` (e.g., 'maria')

## Image Composition

Images are layered on canvas in this order:

1. **Background** (0, 0, 100% width, 100% height)
2. **Character** (5% from left, 15% from top, 40% width, 80% height)
3. **Object** (55% from left, 25% from top, 35% width, 50% height)
4. **Text** (centered, starting at `topMargin` from top)
5. **Streak Diamond** (top-left corner, animated)

## Adding New Flash Cards

### Step 1: Create Object Images
Add PNG images to `public/images/flash-cards/objects/` with filenames matching the Spanish text (e.g., `la manzana.png`)

### Step 2: Update Configuration
Edit `src/config/flash-cards/food.js` to add new card entries:

```javascript
{
  questionId: 'food_XXX',
  object: 'el objeto.png',
  emotion: 'pleased.png',
}
```

### Step 3: Verify Question Data
Ensure the `questionId` exists in `src/config/questions/food.js` and has a translation in `src/config/translations/answers/food.js`

## Available Emotions

From `public/images/flash-cards/characters/elvis/`:
- `laughing.png` - Happy, joyful
- `pleased.png` - Satisfied, content
- `welcoming.png` - Friendly, inviting
- `confused.png` - Puzzled, uncertain
- `angry.png` - Upset, mad
- `defensive.png` - Guarded, protective
- `disappointed.png` - Sad, let down
- `horrified.png` - Shocked, scared
- `indifferent.png` - Neutral, unbothered

## Creating Additional Assets

### Backgrounds
- Size: 360x240px (or scalable)
- Format: PNG with transparency support
- Location: `public/images/flash-cards/backgrounds/`
- Naming: Descriptive (e.g., `purple.png`, `beach.png`)

### Characters
- Size: Should fit in 40% canvas width, 80% height
- Format: PNG with transparency
- Location: `public/images/flash-cards/characters/{name}/`
- Each character needs all 9 emotion files

### Objects
- Size: Should fit in 35% canvas width, 50% height
- Format: PNG with transparency
- Location: `public/images/flash-cards/objects/`
- Naming: Use Spanish text with article (e.g., `la manzana.png`)

## Current Status

### âœ… Implemented
- Dynamic canvas-based composition system
- Multi-layer image loading and rendering
- Character emotion system
- Per-card customization options
- Backward-compatible configuration structure

### ğŸ“‹ To Do
- Create remaining object images for all 10 food items:
  - âœ… la sandÃ­a.png (exists as per config)
  - âŒ el plÃ¡tano.png
  - âŒ la manzana.png
  - âŒ la naranja.png
  - âŒ la piÃ±a.png
  - âŒ la pizza.png
  - âŒ la hamburguesa.png
  - âŒ el taco.png
  - âŒ el pollo.png
  - âŒ el helado.png
- Optionally create additional backgrounds
- Optionally add more characters (currently only 'elvis' exists)

## Migration Notes

### Changes from Old System
**Before:** Single sprite sheet PNG with 10 cards (3600x240px)
**After:** Dynamic composition of 3-4 separate images per card

### Removed Code
- `spriteWidth`, `spriteHeight` config properties
- `offsetX`, `offsetY` config properties
- `cardSpacing` config property
- `getCardSourceRect()` function
- Sprite sheet image loading

### Added Code
- `defaultBackground`, `defaultCharacter`, `defaultEmotion` config properties
- Per-card `object`, `emotion`, `background`, `character` properties
- Multi-image preloading system
- Layer-based canvas rendering

## Example Usage

```javascript
// In food.js configuration
cards: [
  {
    questionId: 'food_001',
    object: 'la sandÃ­a.png',
    emotion: 'laughing.png',
    // Uses defaults for background and character
  },
  {
    questionId: 'food_002',
    object: 'el plÃ¡tano.png',
    emotion: 'pleased.png',
    background: 'blue.png',  // Override background
  },
]
```

The system will automatically:
1. Load the background image
2. Load Elvis with the specified emotion
3. Load the object image
4. Composite them on canvas
5. Render Spanish and English text
6. Animate the streak diamond

## Troubleshooting

### Images not showing
- Check browser console for 404 errors
- Verify file paths match config exactly (case-sensitive)
- Ensure image files exist in correct folders
- Check BASE_URL configuration

### Layout issues
- Adjust positioning percentages in `FlashCardsDialog.jsx`
- Modify text rendering in `text` config object
- Verify canvas dimensions match design requirements

### Performance
- Images are preloaded per card (loaded on card change)
- Uses `requestAnimationFrame` for smooth animation
- Consider adding loading states for slow connections
